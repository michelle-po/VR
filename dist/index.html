<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>IM VR</title>
    <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
    <script src="https://rawgit.com/fernandojsg/aframe-teleport-controls/master/dist/aframe-teleport-controls.min.js"></script>
    <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script>
    <script src="bundle.js"></script>
  </head>
  <body>
    <a-scene
      stats
      inspector-plugin-recast
      background="color: #a3d0ed"
      fog="type: linear; color: #a3d0ed; near: 30; far: 60"
    >
      <a-assets>
        <a-asset-item id="navmesh_spawn" src="assets/navmesh.gltf"></a-asset-item>
        <a-asset-item id="navmesh_elevator" src="assets/navmesh_elevator.gltf"></a-asset-item>
      </a-assets>

      <a-entity id="navmesh-manager" navmesh-manager="navmesh: #nav-mesh-spawn"
        event-set="_event: elevator; navmesh-manager.navmesh: #nav-mesh-elevator"
        listen-to="target: #btn-platform-1; event: click; emit: elevator"
        event-set__final="_event: final; navmesh-manager.navmesh: #nav-mesh-final"
        listen-to__final="target: #platform-1; event: animationcomplete; emit: final"
      >

      </a-entity>
      <a-entity nav-mesh id="nav-mesh-spawn" gltf-model="#navmesh_spawn" visible="false"></a-entity>
      <a-entity nav-mesh-disable position="0 0.2 0" id="nav-mesh-elevator" gltf-model="#navmesh_elevator" visible="false"></a-entity>
      <a-entity nav-mesh-disable position="0 11 0" id="nav-mesh-final" gltf-model="#navmesh_spawn" visible="false"></a-entity>

      <a-entity light="type: ambient; color: #445451"></a-entity>
      <a-entity light="type: point; intensity: 1;" position="0 25 0"></a-entity>

      <a-entity position="0 -0.3 0">
        <a-ocean depth="150" width="150" amplitude="0" amplitude-variance="0.1" opacity="1" density="50"></a-ocean>
        <a-ocean depth="150" width="150" opacity="0.5" amplitude="0" amplitude-variance="0.15" density="50"></a-ocean>
      </a-entity>


      <a-hexatile position="0 -1 0" size="5" cellsize="0.5" color="#216138"></a-hexatile>
      <a-hexatile position="0 10 0" size="5" cellsize="0.5" color="#216138"></a-hexatile>


      <a-entity position="0 0 -6.1">
        <a-hexatile id="platform-1" position="0 -1 0" size="3" cellsize="0.5" height="1" color="#216138"
          listen-to="target: #btn-platform-1; event: click; emit: up"
          animation="property: object3D.position.y; to: 10; dur: 5000; easing: linear; startEvents: up"
        ></a-hexatile>
        <a-hexatile id="btn-platform-1" hover-highlighter size="1" cellsize=".25" height="1" color="tomato"></a-hexatile>
      </a-entity>

      <a-entity id="rig"
        disable-in-vr="component: movement-controls"
        movement-controls="constrainToNavMesh: true;"
        position="0 0 3"
        listen-to="target: #btn-platform-1; event: click; emit: up"
        animation="property: object3D.position.y; to: 11; dur: 5000; easing: linear; startEvents: up"
      >

        <a-entity id="head" position="0 1.7 0" camera look-controls="pointerLockEnabled: true">
          <a-entity
            id="eyes"
            geometry="primitive: circle; radius: 0.0005"
            material="color: black"
            position="0 0 -0.1"
            cursor
            disable-in-vr="component: geometry"
            disable-in-vr__cursor="component: cursor"
            raycaster="objects: [hover-highlighter]; far: 1.5"
          ></a-entity>
        </a-entity>

        <a-entity id="hands" position="0 0.9 0" bind-rotation="target: #head" disable-in-vr="component: bind-rotation" disable-in-vr__pos="component: position">
          <a-entity id="left-hand"
            position="-0.3 0 -0.3"
            rotation="0 0 90"
            bind-rotation="target: #head"
            disable-in-vr="component: bind-rotation"
            hand-controls="hand: left"
            teleport-controls="cameraRig: #rig; collisionEntities: #nav-mesh-spawn; button: trigger; curveShootingSpeed: 8"
          ></a-entity>
          <a-entity id="right-hand"
            position="0.3 0 -0.3"
            rotation="0 0 -90"
            bind-rotation="target: #head"
            disable-in-vr="component: bind-rotation"
            hand-controls="hand: right"
            laser-controls="hand: right"
            raycaster="far: 1.5; objects: [hover-highlighter]; showLine: true"
          ></a-entity>
        </a-entity>

      </a-entity>

    </a-scene>

    <script>

    </script>
  </body>
</html>